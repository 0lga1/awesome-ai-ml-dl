---

- step:
    name: Run dl4j-mnist-single-layer train model
    image: neomatrix369/dl4j-mnist-single-layer:v0.1
    command:
      - cd /workspace
      - ./runMLPMnist.sh {parameters}
      - cp ${VH_OUTPUTS_DIR}/*.pb ${VH_INPUTS_DIR}
    parameters:
      - name: --action
        pass-as: '--action {v}'
        type: string
        default: train
        description: Action to perform i.e. train or evaluate
      - name: --output-dir
        pass-as: '--output-dir {v}'
        type: string
        default: /valohai/outputs/
        description: Output directory where the model will be created, best to pick the Valohai output directory
    environment: aws-eu-west-1-g2.2xlarge

- step:
    name: Run dl4j-mnist-single-layer evaluate model
    image: neomatrix369/dl4j-mnist-single-layer:v0.1
    command:
      - cd /workspace
      - ./runMLPMnist.sh {parameters}
    parameters:
      - name: --action
        pass-as: '--action {v}'
        type: string
        default: evaluate
        description: Action to perform i.e. train or evaluate
      - name: --input-dir
        pass-as: '--input-dir {v}'
        type: string
        default: /valohai/inputs/
        description: Input directory where the model created by the previous step can be found created
    environment: aws-eu-west-1-g2.2xlarge